<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda Jur√≠dica Completa (Local)</title>
    <!-- Carrega o Tailwind CSS para estiliza√ß√£o moderna e responsiva -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { font-family: 'Inter', sans-serif; }
        
        /* Definindo cores personalizadas para melhor controle e consist√™ncia */
        .text-navy-main { color: #1E40AF; } /* Novo Azul Marinho Profundo (mais claro que o anterior) */
        .bg-navy-main { background-color: #1E40AF; }
        .hover\:bg-navy-hover:hover { background-color: #1c36a4; } /* Tom um pouco mais escuro para hover */
        .text-yellow-500 { color: #F59E0B; } /* Amarelo Ferrari / Amber */
        .bg-yellow-500 { background-color: #F59E0B; }
        .hover\:bg-yellow-600:hover { background-color: #D97706; }
        .border-yellow-500 { border-color: #F59E0B; }

        .dashboard-grid {
            /* Layout responsivo: uma coluna no mobile, duas em telas maiores */
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        @media (min-width: 1024px) {
            /* Coluna de visualiza√ß√£o maior, coluna de cadastro menor */
            .dashboard-grid {
                grid-template-columns: 2fr 1fr; 
            }
        }
        
        /* Ajuste de fonte para o painel de visualiza√ß√£o */
        .text-xl-tv { font-size: clamp(1.1rem, 2.5vw, 2.25rem); }
        .text-lg-tv { font-size: clamp(0.9rem, 1.8vw, 1.3rem); }
        .text-md-tv { font-size: clamp(0.8rem, 1.5vw, 1.1rem); }

        /* --- CSS para o Efeito de Piscar (Alerta de Proximidade) --- */
        /* Alerta piscando com cores de destaque Amarelo/Azul */
        @keyframes flash-alert {
            0%, 100% { background-color: #fffbeb; border-color: #fcd34d; } /* Amber-50 / Amber-300 */
            50% { background-color: #fde68a; border-color: #fbbf24; } /* Amber-200 / Amber-400 */
        }
        .flash-alert {
            animation: flash-alert 1.5s infinite alternate ease-in-out;
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.8); /* Yellow glow */
            border-left-width: 8px !important; 
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 lg:p-8">

    <div id="loading" class="fixed inset-0 bg-gray-100 flex items-center justify-center z-50">
        <div class="text-center">
            <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-yellow-500 mx-auto"></div>
            <p class="mt-4 text-navy-main font-semibold">Iniciando Aplica√ß√£o Local...</p>
        </div>
    </div>

    <!-- CABE√áALHO AGORA EM AZUL MARINHO (#1E40AF) -->
    <header class="text-center mb-6 lg:mb-10 bg-navy-main p-6 rounded-xl shadow-xl max-w-7xl mx-auto">
        <h1 class="text-3xl lg:text-5xl font-extrabold text-yellow-500">
            Agenda Jur√≠dica Completa
        </h1>
        <p id="week-range" class="text-xl lg:text-2xl font-medium text-gray-200 mt-2">
            Visualize, cadastre e edite suas audi√™ncias em tempo real.
        </p>
    </header>

    <main id="app-content" class="dashboard-grid max-w-7xl mx-auto" style="display:none;">

        <!-- Coluna de Visualiza√ß√£o (Dashboard) - TOPO -->
        <section class="bg-white p-6 rounded-xl shadow-2xl lg:col-span-1 lg:order-1">
            <h2 class="text-3xl font-bold text-navy-main mb-6 border-b-2 border-yellow-500 pb-2" id="dashboard-title">Pr√≥ximas Audi√™ncias (Agenda Completa)</h2>
            <div id="hearings-list" class="space-y-4">
                <!-- As audi√™ncias ser√£o injetadas aqui -->
            </div>
            <div id="no-hearings-message" class="hidden mt-8 text-center p-8 bg-yellow-50 rounded-lg border-2 border-dashed border-yellow-300">
                <p class="text-xl-tv font-semibold text-navy-main">
                    üéâ Nenhuma audi√™ncia cadastrada ou pendente!
                </p>
                <p class="text-lg-tv text-gray-700 mt-2">
                    Use o formul√°rio ao lado para adicionar os processos √† agenda.
                </p>
            </div>
        </section>

        <!-- Coluna de Cadastro/Edi√ß√£o - BAIXO -->
        <section class="bg-white p-6 rounded-xl shadow-2xl h-fit lg:col-span-1 lg:order-2">
            <h2 id="form-title" class="text-2xl font-bold text-navy-main mb-4 border-b-2 border-yellow-500 pb-2">Cadastrar Nova Audi√™ncia</h2>
            <form id="hearing-form" class="space-y-4">
                
                <!-- Data e Hora -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="date" class="block text-sm font-medium text-gray-700">Data *</label>
                        <input type="date" id="date" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-yellow-500 focus:border-yellow-500 transition duration-150">
                    </div>
                    <div>
                        <label for="time" class="block text-sm font-medium text-gray-700">Hora *</label>
                        <input type="time" id="time" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-yellow-500 focus:border-yellow-500 transition duration-150">
                    </div>
                </div>

                <!-- N¬∞ Processo e Vara -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="case-number" class="block text-sm font-medium text-gray-700">N¬∫ do Processo *</label>
                        <input type="text" id="case-number" required placeholder="Ex: 0012345-67.2023.8.26.0053" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-yellow-500 focus:border-yellow-500 transition duration-150">
                    </div>
                    <div>
                        <label for="vara" class="block text-sm font-medium text-gray-700">Vara *</label>
                        <input type="text" id="vara" required placeholder="Ex: 3¬™ Vara C√≠vel de S√£o Paulo" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-yellow-500 focus:border-yellow-500 transition duration-150">
                    </div>
                </div>

                <!-- Reclamante e Reclamada -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="reclamante" class="block text-sm font-medium text-gray-700">Reclamante *</label>
                        <input type="text" id="reclamante" required placeholder="Nome do Reclamante" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-yellow-500 focus:border-yellow-500 transition duration-150">
                    </div>
                    <div>
                        <label for="reclamada" class="block text-sm font-medium text-gray-700">Reclamada *</label>
                        <input type="text" id="reclamada" required placeholder="Nome da Reclamada" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-yellow-500 focus:border-yellow-500 transition duration-150">
                    </div>
                </div>

                <!-- Natureza, Tipo de Audi√™ncia e Patrono -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="natureza" class="block text-sm font-medium text-gray-700">Natureza *</label>
                        <input type="text" id="natureza" required placeholder="Ex: Trabalhista / C√≠vel" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-yellow-500 focus:border-yellow-500 transition duration-150">
                    </div>
                    <div>
                        <label for="tipo-audiencia" class="block text-sm font-medium text-gray-700">Tipo de Audi√™ncia *</label>
                        <input type="text" id="tipo-audiencia" required placeholder="Ex: Instru√ß√£o e Julgamento" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-yellow-500 focus:border-yellow-500 transition duration-150">
                    </div>
                    <div>
                        <label for="patrono" class="block text-sm font-medium text-gray-700">Patrono</label>
                        <input type="text" id="patrono" placeholder="OAB e Nome do Patrono" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-yellow-500 focus:border-yellow-500 transition duration-150">
                    </div>
                </div>

                <!-- Endere√ßo (Tipo e Campo) -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="endereco-tipo" class="block text-sm font-medium text-gray-700">Tipo de Endere√ßo *</label>
                        <select id="endereco-tipo" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-yellow-500 focus:border-yellow-500 transition duration-150">
                            <option value="Virtual">Virtual (Link)</option>
                            <option value="Presencial">Presencial (Endere√ßo)</option>
                        </select>
                    </div>
                    <div>
                        <label for="endereco-link" class="block text-sm font-medium text-gray-700"><span id="endereco-label">Link da Audi√™ncia</span> *</label>
                        <input type="text" id="endereco-link" required placeholder="https://linkdaaudiencia.com.br" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-yellow-500 focus:border-yellow-500 transition duration-150">
                    </div>
                </div>

                <!-- Testemunha e Preposto -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="testemunha" class="block text-sm font-medium text-gray-700">Testemunha(s) (Opcional)</label>
                        <textarea id="testemunha" rows="1" placeholder="Nomes ou detalhes das testemunhas" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-yellow-500 focus:border-yellow-500 transition duration-150"></textarea>
                    </div>
                    <div>
                        <label for="preposto" class="block text-sm font-medium text-gray-700">Preposto (Opcional)</label>
                        <input type="text" id="preposto" placeholder="Nome do Preposto" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-yellow-500 focus:border-yellow-500 transition duration-150">
                    </div>
                </div>
                
                <!-- Observa√ß√µes (Descri√ß√£o) -->
                <div>
                    <label for="description" class="block text-sm font-medium text-gray-700">Observa√ß√µes (Opcional)</label>
                    <textarea id="description" rows="2" placeholder="Informa√ß√µes adicionais importantes" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-yellow-500 focus:border-yellow-500 transition duration-150"></textarea>
                </div>

                <!-- Bot√µes de A√ß√£o (Cadastro/Salvar) - AMARERO E AZUL CONTRASTE -->
                <button type="submit" id="submit-btn" class="w-full py-3 px-4 border border-transparent rounded-lg shadow-md text-lg font-medium text-navy-main bg-yellow-500 hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 transition duration-150 ease-in-out">
                    Cadastrar Audi√™ncia
                </button>
            </form>
            <div id="message-box" class="mt-4 hidden p-3 rounded-lg text-center" role="alert"></div>
        </section>
    </main>

    <!-- Modal Customizado para Confirma√ß√£o de Exclus√£o -->
    <div id="confirm-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-[100]">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full">
            <h3 class="text-xl font-bold mb-4 text-red-600">Confirmar Exclus√£o</h3>
            <p class="mb-6 text-gray-700">Tem certeza de que deseja excluir esta audi√™ncia? Esta a√ß√£o √© irrevers√≠vel.</p>
            <div class="flex justify-end space-x-3">
                <button id="cancel-delete" class="px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition duration-150">Cancelar</button>
                <button id="confirm-delete" data-doc-id="" class="px-4 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700 transition duration-150">Excluir</button>
            </div>
        </div>
    </div>


    <script type="module">
        // --- Vari√°veis Globais ---
        const STORAGE_KEY = 'judicial_hearings';
        let isAppReady = false; 
        let editingHearingId = null; 

        // Elementos da UI
        const loadingScreen = document.getElementById('loading');
        const appContent = document.getElementById('app-content');
        const form = document.getElementById('hearing-form');
        const submitBtn = document.getElementById('submit-btn');
        const messageBox = document.getElementById('message-box');
        const hearingsList = document.getElementById('hearings-list');
        const noHearingsMessage = document.getElementById('no-hearings-message');
        const confirmModal = document.getElementById('confirm-modal');
        const confirmDeleteBtn = document.getElementById('confirm-delete');
        const cancelDeleteBtn = document.getElementById('cancel-delete');
        const formTitle = document.getElementById('form-title');
        
        // Elementos de Endere√ßo Condicional
        const enderecoTipoSelect = document.getElementById('endereco-tipo');
        const enderecoLinkInput = document.getElementById('endereco-link');
        const enderecoLabel = document.getElementById('endereco-label');


        // --- Fun√ß√µes de Utilidade ---

        /** Exibe uma mensagem de feedback na UI. */
        function showMessage(message, type) {
            messageBox.textContent = message;
            messageBox.className = 'mt-4 p-3 rounded-lg text-center';
            if (type === 'success') {
                messageBox.classList.add('bg-green-100', 'text-green-800', 'border', 'border-green-300');
            } else if (type === 'error') {
                messageBox.classList.add('bg-red-100', 'text-red-800', 'border', 'border-red-300');
            }
            messageBox.style.display = 'block';
            setTimeout(() => {
                messageBox.style.display = 'none';
            }, 5000);
        }

        /** Formata uma data para o padr√£o de exibi√ß√£o DD/MM. */
        function formatDateForDisplay(dateString) {
            if (!dateString) return '';
            const [year, month, day] = dateString.split('-');
            return `${day}/${month}`;
        }
        
        /** Atualiza o r√≥tulo do campo Endere√ßo/Link com base na sele√ß√£o. */
        function updateAddressLabel() {
            if (enderecoTipoSelect.value === 'Virtual') {
                enderecoLabel.textContent = 'Link da Audi√™ncia';
                enderecoLinkInput.placeholder = 'https://linkdaaudiencia.com.br';
            } else {
                enderecoLabel.textContent = 'Endere√ßo Completo';
                enderecoLinkInput.placeholder = 'Ex: Rua, n√∫mero, cidade, estado';
            }
        }
        
        // --- L√≥gica de Edi√ß√£o ---

        /** Reseta o formul√°rio e o estado de edi√ß√£o. */
        function cancelEdit() {
            editingHearingId = null;
            form.reset();
            updateAddressLabel(); // Garante que o r√≥tulo do endere√ßo volte ao padr√£o
            
            formTitle.textContent = 'Cadastrar Nova Audi√™ncia';
            submitBtn.textContent = 'Cadastrar Audi√™ncia';
            
            // Reverte para o estilo de Cadastro (Amarelo Principal)
            // Usa as classes de cores customizadas
            submitBtn.classList.remove('bg-navy-main', 'hover:bg-navy-hover', 'text-yellow-500', 'focus:ring-navy-main');
            submitBtn.classList.add('bg-yellow-500', 'hover:bg-yellow-600', 'text-navy-main', 'focus:ring-yellow-500');

            // Remove o bot√£o de Cancelar Edi√ß√£o se ele existir
            const cancelBtn = document.getElementById('cancel-edit-btn');
            if (cancelBtn) {
                cancelBtn.remove();
            }
        }

        /** Inicia o modo de edi√ß√£o, preenchendo o formul√°rio. */
        function startEdit(docId) {
            const hearings = getHearingsFromLocalStorage();
            const hearingToEdit = hearings.find(h => h.id === docId);

            if (!hearingToEdit) {
                return showMessage("Erro: Audi√™ncia n√£o encontrada para edi√ß√£o.", 'error');
            }

            // 1. Define o estado de edi√ß√£o
            editingHearingId = docId;

            // 2. Preenche o formul√°rio
            document.getElementById('date').value = hearingToEdit.date;
            document.getElementById('time').value = hearingToEdit.time;
            document.getElementById('case-number').value = hearingToEdit.caseNumber;
            document.getElementById('vara').value = hearingToEdit.vara;
            document.getElementById('reclamada').value = hearingToEdit.reclamada;
            document.getElementById('reclamante').value = hearingToEdit.reclamante;
            document.getElementById('natureza').value = hearingToEdit.natureza;
            document.getElementById('patrono').value = hearingToEdit.patrono;
            document.getElementById('tipo-audiencia').value = hearingToEdit.tipoAudiencia;
            enderecoTipoSelect.value = hearingToEdit.enderecoTipo;
            enderecoLinkInput.value = hearingToEdit.enderecoLink;
            document.getElementById('testemunha').value = hearingToEdit.testemunha;
            document.getElementById('preposto').value = hearingToEdit.preposto;
            document.getElementById('description').value = hearingToEdit.description;

            // 3. Atualiza a UI (t√≠tulo, bot√£o e adiciona o Cancelar)
            updateAddressLabel(); // Garante que o r√≥tulo do endere√ßo atualize
            
            formTitle.textContent = `Editando Audi√™ncia: ${hearingToEdit.caseNumber}`;
            submitBtn.textContent = 'Salvar Altera√ß√µes';
            
            // Define o estilo de Edi√ß√£o (Azul Marinho Principal com texto Amarelo)
            // Usa as classes de cores customizadas
            submitBtn.classList.remove('bg-yellow-500', 'hover:bg-yellow-600', 'text-navy-main', 'focus:ring-yellow-500');
            submitBtn.classList.add('bg-navy-main', 'hover:bg-navy-hover', 'text-yellow-500', 'focus:ring-navy-main');

            // Adiciona o bot√£o de Cancelar Edi√ß√£o se ele n√£o estiver l√°
            if (!document.getElementById('cancel-edit-btn')) {
                const cancelBtn = document.createElement('button');
                cancelBtn.type = 'button';
                cancelBtn.id = 'cancel-edit-btn';
                cancelBtn.textContent = 'Cancelar Edi√ß√£o';
                // Estilo para o bot√£o de Cancelar (Amarelo claro)
                cancelBtn.className = 'w-full py-3 px-4 rounded-lg text-lg font-medium text-navy-main bg-yellow-200 hover:bg-yellow-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 transition duration-150 ease-in-out';
                cancelBtn.addEventListener('click', cancelEdit);
                // Insere o bot√£o de Cancelar logo antes do bot√£o de Salvar
                submitBtn.parentElement.insertBefore(cancelBtn, submitBtn);
            }
            
            // Rola para o formul√°rio para facilitar a edi√ß√£o em dispositivos m√≥veis
            form.scrollIntoView({ behavior: 'smooth' });
        }
        
        // --- L√≥gica do Local Storage ---

        /** Obt√©m todas as audi√™ncias do localStorage. */
        function getHearingsFromLocalStorage() {
            const data = localStorage.getItem(STORAGE_KEY);
            try {
                return data ? JSON.parse(data) : [];
            } catch (e) {
                console.error("Erro ao analisar dados do localStorage. Dados corrompidos.", e);
                return [];
            }
        }
        
        /** Inicializa a aplica√ß√£o (sem Firebase, apenas para UI e localStorage). */
        function initializeApp() {
            loadingScreen.style.display = 'none';
            appContent.style.display = 'grid';
            isAppReady = true;
            updateAddressLabel(); 
            loadHearings();
        }

        /** Adiciona ou Atualiza uma audi√™ncia no localStorage. */
        async function saveHearing(e) {
            e.preventDefault();
            if (!isAppReady) return showMessage("Aguardando inicializa√ß√£o do sistema...", 'error');

            // 1. Coleta os dados do formul√°rio
            const isEditing = editingHearingId !== null;
            const actionText = isEditing ? 'Salvar Altera√ß√µes' : 'Cadastrar Audi√™ncia';
            submitBtn.textContent = isEditing ? 'Atualizando...' : 'Salvando...';
            submitBtn.disabled = true;

            const hearingData = {
                id: isEditing ? editingHearingId : crypto.randomUUID(), 
                caseNumber: document.getElementById('case-number').value.trim(),
                date: document.getElementById('date').value,
                time: document.getElementById('time').value,
                vara: document.getElementById('vara').value.trim(),
                reclamada: document.getElementById('reclamada').value.trim(),
                reclamante: document.getElementById('reclamante').value.trim(),
                natureza: document.getElementById('natureza').value.trim(),
                patrono: document.getElementById('patrono').value.trim(),
                tipoAudiencia: document.getElementById('tipo-audiencia').value.trim(),
                enderecoTipo: enderecoTipoSelect.value, 
                enderecoLink: enderecoLinkInput.value.trim(),
                testemunha: document.getElementById('testemunha').value.trim(),
                preposto: document.getElementById('preposto').value.trim(),
                description: document.getElementById('description').value.trim(),
            };
            
            try {
                let existingHearings = getHearingsFromLocalStorage();

                if (isEditing) {
                    // L√≥gica de EDI√á√ÉO/ATUALIZA√á√ÉO
                    const index = existingHearings.findIndex(h => h.id === editingHearingId);
                    if (index !== -1) {
                        existingHearings[index] = hearingData;
                        showMessage('Audi√™ncia atualizada com sucesso!', 'success');
                    } else {
                        throw new Error("ID de audi√™ncia para edi√ß√£o n√£o encontrado.");
                    }
                } else {
                    // L√≥gica de NOVO CADASTRO
                    existingHearings.push(hearingData);
                    showMessage('Audi√™ncia cadastrada com sucesso!', 'success');
                }

                localStorage.setItem(STORAGE_KEY, JSON.stringify(existingHearings));

                cancelEdit(); // Reseta o formul√°rio e o estado de edi√ß√£o
                loadHearings(); // Recarrega a lista
            } catch (error) {
                console.error("Erro ao salvar audi√™ncia no localStorage:", error);
                showMessage(`Erro ao salvar: ${error.message}`, 'error');
            } finally {
                submitBtn.textContent = actionText; // Volta ao texto original (Salvar ou Cadastrar)
                submitBtn.disabled = false;
            }
        }

        /** Remove uma audi√™ncia do localStorage. */
        async function deleteHearing(docId) {
            if (!isAppReady) return showMessage("Aguardando inicializa√ß√£o do sistema...", 'error');

            try {
                let existingHearings = getHearingsFromLocalStorage();
                const updatedHearings = existingHearings.filter(h => h.id !== docId);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(updatedHearings));

                showMessage('Audi√™ncia exclu√≠da com sucesso!', 'success');
                loadHearings(); // Recarrega a lista
                cancelEdit(); // Limpa o formul√°rio caso a audi√™ncia exclu√≠da estivesse sendo editada
            } catch (error) {
                console.error("Erro ao excluir audi√™ncia:", error);
                showMessage(`Erro ao excluir: ${error.message}`, 'error');
            }
        }

        /**
         * Renderiza a lista de audi√™ncias.
         */
        function renderHearings(hearings) {
            hearingsList.innerHTML = '';
            const now = new Date();

            if (hearings.length === 0) {
                noHearingsMessage.classList.remove('hidden');
                return;
            }
            noHearingsMessage.classList.add('hidden');

            // Ordena cronologicamente: do mais pr√≥ximo/futuro para o mais distante/passado.
            hearings.sort((a, b) => {
                const dateA = new Date(`${a.date}T${a.time}:00`);
                const dateB = new Date(`${b.date}T${b.time}:00`);
                return dateA - dateB; // Crescente: garante que a pr√≥xima audi√™ncia esteja no topo
            });
            
            // Separa em Pr√≥ximas (Futuro) e Realizadas (Passado)
            const upcomingHearings = hearings.filter(h => new Date(`${h.date}T${h.time}:00`) >= now);
            const pastHearings = hearings.filter(h => new Date(`${h.date}T${h.time}:00`) < now);

            // Combina novamente para exibi√ß√£o: Pr√≥ximas no topo (ordem crescente), seguidas pelas Realizadas (ordem decrescente)
            const finalHearings = [
                ...upcomingHearings,
                ...pastHearings.sort((a, b) => { // Inverte a ordem das passadas (mais recente no topo do grupo)
                    const dateA = new Date(`${a.date}T${a.time}:00`);
                    const dateB = new Date(`${b.date}T${b.time}:00`);
                    return dateB - dateA; 
                })
            ];

            const daysOfWeek = ['Domingo', 'Segunda-feira', 'Ter√ßa-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'S√°bado'];
            let lastGroupHeader = null;

            finalHearings.forEach(h => {
                const hearingDateTime = new Date(`${h.date}T${h.time}:00`);
                const isPast = hearingDateTime < now;
                
                // Calcula a diferen√ßa para o alerta de 1 dia (24 horas)
                const timeDifference = hearingDateTime.getTime() - now.getTime();
                const isImminent = timeDifference > 0 && timeDifference <= (24 * 60 * 60 * 1000); // Menos de 24h

                let groupHeader = isPast ? "Audi√™ncias Realizadas" : "Pr√≥ximas Audi√™ncias";

                if (groupHeader !== lastGroupHeader) {
                    hearingsList.innerHTML += `
                        <h3 class="text-2xl font-extrabold ${isPast ? 'text-gray-500 border-gray-400' : 'text-navy-main border-yellow-500'} mt-8 mb-4 border-b-2 pb-1">
                            ${groupHeader}
                        </h3>
                    `;
                    lastGroupHeader = groupHeader;
                }

                const card = document.createElement('div');
                const docId = h.id; 
                
                // Aplica a classe de piscar (flash-alert) se for iminente
                card.className = `p-4 lg:p-6 rounded-xl shadow-md transition duration-300 relative group 
                                  ${isImminent ? 'flash-alert' : (isPast ? 'bg-gray-100 border-l-4 border-gray-400 opacity-80' : 'bg-white border-l-4 border-yellow-500 hover:shadow-lg')}
                                  ${isImminent ? 'border-yellow-500' : (isPast ? 'border-gray-400' : 'border-yellow-500')}`;

                // √çcone para indicar Presencial/Virtual (Azul Marinho para bom contraste)
                const iconSVG = h.enderecoTipo === 'Virtual' 
                    ? `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-navy-main" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-7-8a7 7 0 1114 0 7 7 0 01-14 0zm7 3a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" /></svg>`
                    : `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-navy-main" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" /></svg>`;

                card.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <!-- Data e Hora -->
                        <div class="flex items-center">
                            ${iconSVG}
                            <p class="text-xl-tv font-bold text-navy-main">${daysOfWeek[hearingDateTime.getDay()]}, ${formatDateForDisplay(h.date)} √†s ${h.time}h</p>
                            ${isPast ? '<span class="ml-3 text-sm font-semibold text-gray-600 bg-gray-200 px-2 py-0.5 rounded-full">REALIZADA</span>' : (isImminent ? '<span class="ml-3 text-sm font-semibold text-navy-main bg-yellow-200 px-2 py-0.5 rounded-full">IMINENTE</span>' : '')}
                        </div>
                        
                        <!-- Bot√µes de A√ß√£o (Editar e Excluir) -->
                        <div class="flex space-x-2 opacity-0 group-hover:opacity-100 transition duration-300 absolute top-2 right-2">
                            <!-- Bot√£o de Editar (Amarelo) -->
                            <button data-id="${docId}" class="edit-btn text-yellow-500 hover:text-yellow-700 p-1 rounded-full bg-white shadow-md" aria-label="Editar Audi√™ncia">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zm-1.414 4.316l-7.85-7.85A1 1 0 001.05 3.121v14.757a1 1 0 001.05.793h14.757a1 1 0 00.793-1.05V7.9l-2.613-2.613 1.414-1.414z" fill-rule="evenodd" clip-rule="evenodd" /></svg>
                            </button>
                            <!-- Bot√£o de Excluir (Vermelho - cor de alerta mantida) -->
                            <button data-id="${docId}" class="delete-btn text-red-500 hover:text-red-700 p-1 rounded-full bg-white shadow-md" aria-label="Excluir Audi√™ncia">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.728-1.447A1 1 0 0011 2H9zM7 7a1 1 0 011 1v6a1 1 0 11-2 0V8a1 1 0 011-1zm5 0a1 1 0 011 1v6a1 1 0 11-2 0V8a1 1 0 011-1z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Informa√ß√µes Principais (Azul Marinho para contraste) -->
                    <p class="text-lg-tv font-extrabold text-navy-main break-words">${h.caseNumber} - ${h.tipoAudiencia}</p>
                    <p class="text-md-tv text-gray-700"><span class="font-semibold">Vara:</span> ${h.vara}</p>
                    
                    <!-- Partes -->
                    <p class="text-md-tv text-gray-600"><span class="font-semibold">Partes:</span> ${h.reclamante} <span class="text-gray-400">vs</span> ${h.reclamada} (${h.natureza})</p>

                    <!-- Detalhes de Local/Link (Amarelo) -->
                    <p class="text-md-tv mt-2">
                        <span class="font-semibold">${h.enderecoTipo}:</span> 
                        ${h.enderecoTipo === 'Virtual' 
                            ? `<a href="${h.enderecoLink}" target="_blank" class="text-yellow-600 hover:text-yellow-700 underline truncate max-w-full inline-block">${h.enderecoLink}</a>`
                            : `${h.enderecoLink}`}
                    </p>
                    
                    <!-- Detalhes Secund√°rios -->
                    <div class="grid grid-cols-1 md:grid-cols-2 text-sm text-gray-500 mt-2 border-t pt-2">
                        <p class="truncate"><span class="font-semibold">Patrono:</span> ${h.patrono || 'N/A'}</p>
                        <p class="truncate"><span class="font-semibold">Preposto:</span> ${h.preposto || 'N/A'}</p>
                    </div>

                    <!-- Observa√ß√µes -->
                    ${h.description ? `<p class="text-sm italic text-gray-500 mt-2">${h.description}</p>` : ''}
                `;
                hearingsList.appendChild(card);
            });

            // Adiciona listeners para os bot√µes de a√ß√£o (Excluir e Editar)
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.stopPropagation(); 
                    const docId = e.currentTarget.getAttribute('data-id');
                    confirmDeleteBtn.setAttribute('data-doc-id', docId);
                    confirmModal.classList.remove('hidden');
                });
            });

            document.querySelectorAll('.edit-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.stopPropagation(); 
                    const docId = e.currentTarget.getAttribute('data-id');
                    startEdit(docId);
                });
            });
        }

        /** Carrega e filtra todas as audi√™ncias a partir do localStorage. */
        function loadHearings() {
            if (!isAppReady) {
                console.warn("App n√£o pronta. Tentando novamente...");
                return; 
            }
            
            try {
                const allHearings = getHearingsFromLocalStorage();
                renderHearings(allHearings);

            } catch (error) {
                console.error("Erro ao carregar dados do localStorage:", error);
                showMessage(`Erro ao carregar dados: ${error.message}`, 'error');
            }
        }

        // --- Event Listeners ---

        form.addEventListener('submit', saveHearing);
        enderecoTipoSelect.addEventListener('change', updateAddressLabel);

        confirmDeleteBtn.addEventListener('click', () => {
            const docId = confirmDeleteBtn.getAttribute('data-doc-id');
            if (docId) {
                deleteHearing(docId);
            }
            confirmModal.classList.add('hidden');
            confirmDeleteBtn.removeAttribute('data-doc-id');
        });

        cancelDeleteBtn.addEventListener('click', () => {
            confirmModal.classList.add('hidden');
            confirmDeleteBtn.removeAttribute('data-doc-id');
        });

        // Inicializa o app ao carregar a janela
        window.onload = initializeApp;

    </script>
</body>
</html>
